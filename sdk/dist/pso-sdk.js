!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.PSOPayment=n():e.PSOPayment=n()}(this,()=>(()=>{"use strict";var e={365(e,n,t){t.d(n,{A:()=>i});var o=t(601),r=t.n(o),a=t(314),s=t.n(a)()(r());s.push([e.id,"/* PSO Payment SDK Styles */\n\n/* Overlay */\n.pso-overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.5);\n  z-index: 999999;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  opacity: 0;\n  transition: opacity 0.3s ease;\n}\n\n.pso-overlay.pso-active {\n  opacity: 1;\n}\n\n/* Popup Container */\n.pso-popup {\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);\n  max-width: 500px;\n  width: 90%;\n  max-height: 90vh;\n  overflow-y: auto;\n  transform: scale(0.9);\n  transition: transform 0.3s ease;\n}\n\n.pso-popup.pso-active {\n  transform: scale(1);\n}\n\n/* Header */\n.pso-header {\n  padding: 20px 24px;\n  border-bottom: 1px solid #e5e7eb;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.pso-header h2 {\n  margin: 0;\n  font-size: 24px;\n  font-weight: 600;\n  color: #111827;\n}\n\n.pso-close {\n  background: none;\n  border: none;\n  font-size: 32px;\n  line-height: 1;\n  color: #6b7280;\n  cursor: pointer;\n  padding: 0;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 4px;\n  transition: background-color 0.2s;\n}\n\n.pso-close:hover {\n  background-color: #f3f4f6;\n}\n\n/* Body */\n.pso-body {\n  padding: 24px;\n}\n\n/* Amount Display */\n.pso-amount {\n  background: #f9fafb;\n  padding: 16px;\n  border-radius: 8px;\n  margin-bottom: 24px;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.pso-amount .pso-label {\n  font-size: 14px;\n  color: #6b7280;\n}\n\n.pso-amount .pso-value {\n  font-size: 24px;\n  font-weight: 700;\n  color: #111827;\n}\n\n/* Form */\n.pso-form {\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n}\n\n.pso-field {\n  display: flex;\n  flex-direction: column;\n}\n\n.pso-field label {\n  font-size: 14px;\n  font-weight: 500;\n  color: #374151;\n  margin-bottom: 6px;\n}\n\n.pso-field input {\n  padding: 12px;\n  border: 1px solid #d1d5db;\n  border-radius: 6px;\n  font-size: 16px;\n  transition: border-color 0.2s, box-shadow 0.2s;\n}\n\n.pso-field input:focus {\n  outline: none;\n  border-color: #3b82f6;\n  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n}\n\n.pso-field input::placeholder {\n  color: #9ca3af;\n}\n\n/* Row Layout */\n.pso-row {\n  display: flex;\n  gap: 12px;\n}\n\n.pso-field-half {\n  flex: 1;\n}\n\n/* Error Messages */\n.pso-error {\n  color: #ef4444;\n  font-size: 13px;\n  margin-top: 4px;\n  display: none;\n}\n\n.pso-global-error {\n  background: #fee2e2;\n  color: #991b1b;\n  padding: 12px;\n  border-radius: 6px;\n  margin-bottom: 16px;\n  font-size: 14px;\n}\n\n/* Submit Button */\n.pso-submit-btn {\n  background: #3b82f6;\n  color: white;\n  border: none;\n  padding: 14px 24px;\n  border-radius: 6px;\n  font-size: 16px;\n  font-weight: 600;\n  cursor: pointer;\n  transition: background-color 0.2s;\n  margin-top: 8px;\n}\n\n.pso-submit-btn:hover {\n  background: #2563eb;\n}\n\n.pso-submit-btn:disabled {\n  background: #9ca3af;\n  cursor: not-allowed;\n}\n\n/* Loading State */\n.pso-loading {\n  text-align: center;\n  padding: 40px 20px;\n}\n\n.pso-spinner {\n  width: 48px;\n  height: 48px;\n  border: 4px solid #e5e7eb;\n  border-top-color: #3b82f6;\n  border-radius: 50%;\n  animation: pso-spin 1s linear infinite;\n  margin: 0 auto 16px;\n}\n\n@keyframes pso-spin {\n  to {\n    transform: rotate(360deg);\n  }\n}\n\n.pso-loading p {\n  color: #6b7280;\n  font-size: 14px;\n  margin: 0;\n}\n\n/* Security Info */\n.pso-security-info {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 6px;\n  margin-top: 20px;\n  padding-top: 20px;\n  border-top: 1px solid #e5e7eb;\n  font-size: 12px;\n  color: #6b7280;\n}\n\n.pso-security-info svg {\n  color: #10b981;\n}\n\n/* Responsive Design */\n@media (max-width: 640px) {\n  .pso-popup {\n    width: 95%;\n    max-height: 95vh;\n  }\n\n  .pso-header h2 {\n    font-size: 20px;\n  }\n\n  .pso-amount .pso-value {\n    font-size: 20px;\n  }\n\n  .pso-row {\n    flex-direction: column;\n    gap: 16px;\n  }\n\n  .pso-field-half {\n    width: 100%;\n  }\n}\n\n/* Card Type Icons (Optional Enhancement) */\n.pso-card-icons {\n  display: flex;\n  gap: 8px;\n  margin-top: 8px;\n}\n\n.pso-card-icon {\n  width: 40px;\n  height: 28px;\n  border: 1px solid #e5e7eb;\n  border-radius: 4px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 10px;\n  color: #6b7280;\n}\n",""]);const i=s},314(e){e.exports=function(e){var n=[];return n.toString=function(){return this.map(function(n){var t="",o=void 0!==n[5];return n[4]&&(t+="@supports (".concat(n[4],") {")),n[2]&&(t+="@media ".concat(n[2]," {")),o&&(t+="@layer".concat(n[5].length>0?" ".concat(n[5]):""," {")),t+=e(n),o&&(t+="}"),n[2]&&(t+="}"),n[4]&&(t+="}"),t}).join("")},n.i=function(e,t,o,r,a){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(o)for(var i=0;i<this.length;i++){var p=this[i][0];null!=p&&(s[p]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);o&&s[d[0]]||(void 0!==a&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=a),t&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=t):d[2]=t),r&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=r):d[4]="".concat(r)),n.push(d))}},n}},601(e){e.exports=function(e){return e[1]}},72(e){var n=[];function t(e){for(var t=-1,o=0;o<n.length;o++)if(n[o].identifier===e){t=o;break}return t}function o(e,o){for(var a={},s=[],i=0;i<e.length;i++){var p=e[i],c=o.base?p[0]+o.base:p[0],d=a[c]||0,l="".concat(c," ").concat(d);a[c]=d+1;var u=t(l),h={css:p[1],media:p[2],sourceMap:p[3],supports:p[4],layer:p[5]};if(-1!==u)n[u].references++,n[u].updater(h);else{var m=r(h,o);o.byIndex=i,n.splice(i,0,{identifier:l,updater:m,references:1})}s.push(l)}return s}function r(e,n){var t=n.domAPI(n);return t.update(e),function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap&&n.supports===e.supports&&n.layer===e.layer)return;t.update(e=n)}else t.remove()}}e.exports=function(e,r){var a=o(e=e||[],r=r||{});return function(e){e=e||[];for(var s=0;s<a.length;s++){var i=t(a[s]);n[i].references--}for(var p=o(e,r),c=0;c<a.length;c++){var d=t(a[c]);0===n[d].references&&(n[d].updater(),n.splice(d,1))}a=p}}},659(e){var n={};e.exports=function(e,t){var o=function(e){if(void 0===n[e]){var t=document.querySelector(e);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(e){t=null}n[e]=t}return n[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}},540(e){e.exports=function(e){var n=document.createElement("style");return e.setAttributes(n,e.attributes),e.insert(n,e.options),n}},56(e,n,t){e.exports=function(e){var n=t.nc;n&&e.setAttribute("nonce",n)}},825(e){e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var n=e.insertStyleElement(e);return{update:function(t){!function(e,n,t){var o="";t.supports&&(o+="@supports (".concat(t.supports,") {")),t.media&&(o+="@media ".concat(t.media," {"));var r=void 0!==t.layer;r&&(o+="@layer".concat(t.layer.length>0?" ".concat(t.layer):""," {")),o+=t.css,r&&(o+="}"),t.media&&(o+="}"),t.supports&&(o+="}");var a=t.sourceMap;a&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),n.styleTagTransform(o,e,n.options)}(n,e,t)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)}}}},113(e){e.exports=function(e,n){if(n.styleSheet)n.styleSheet.cssText=e;else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(e))}}}},n={};function t(o){var r=n[o];if(void 0!==r)return r.exports;var a=n[o]={id:o,exports:{}};return e[o](a,a.exports,t),a.exports}t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.nc=void 0;var o={};t.d(o,{default:()=>w});class r{static validateCardNumber(e){const n=e.replace(/\s/g,"");if(!/^\d{13,19}$/.test(n))return{valid:!1,message:"Card number must be 13-19 digits"};let t=0,o=!1;for(let e=n.length-1;e>=0;e--){let r=parseInt(n[e],10);o&&(r*=2,r>9&&(r-=9)),t+=r,o=!o}const r=t%10==0;return{valid:r,message:r?"":"Invalid card number"}}static validateExpiry(e){const n=e.replace(/\s/g,"").match(/^(\d{2})\/(\d{2})$/);if(!n)return{valid:!1,message:"Format should be MM/YY"};const t=parseInt(n[1],10),o=parseInt(n[2],10)+2e3;if(t<1||t>12)return{valid:!1,message:"Invalid month"};const r=new Date;return new Date(o,t-1)<r?{valid:!1,message:"Card has expired"}:{valid:!0,message:""}}static validateCVV(e){const n=e.replace(/\s/g,"");return/^\d{3,4}$/.test(n)?{valid:!0,message:""}:{valid:!1,message:"CVV must be 3-4 digits"}}static validateCardholderName(e){const n=e.trim();return n.length<3?{valid:!1,message:"Name must be at least 3 characters"}:/^[a-zA-Z\s]+$/.test(n)?{valid:!0,message:""}:{valid:!1,message:"Name should contain only letters"}}static sanitizeInput(e){const n=document.createElement("div");return n.textContent=e,n.innerHTML}static getCardType(e){const n=e.replace(/\s/g,"");return/^4/.test(n)?"visa":/^5[1-5]/.test(n)?"mastercard":/^3[47]/.test(n)?"amex":/^6(?:011|5)/.test(n)?"discover":"unknown"}static formatCardNumber(e){return(e.replace(/\s/g,"").match(/.{1,4}/g)||[]).join(" ")}static formatExpiry(e){const n=e.replace(/\D/g,"");return n.length>=2?n.slice(0,2)+"/"+n.slice(2,4):n}}class a{constructor(e){this.config=e,this.overlay=null,this.popup=null,this.isOpen=!1}show(e){this.isOpen||(this.options=e,this.createOverlay(),this.createPopup(),this.attachEventListeners(),this.isOpen=!0,document.body.style.overflow="hidden",setTimeout(()=>{this.overlay.classList.add("pso-active"),this.popup.classList.add("pso-active")},10))}close(){this.isOpen&&(this.overlay.classList.remove("pso-active"),this.popup.classList.remove("pso-active"),setTimeout(()=>{this.overlay&&this.overlay.parentNode&&this.overlay.parentNode.removeChild(this.overlay),this.overlay=null,this.popup=null,this.isOpen=!1,document.body.style.overflow=""},300))}createOverlay(){this.overlay=document.createElement("div"),this.overlay.className="pso-overlay",this.overlay.addEventListener("click",e=>{e.target===this.overlay&&this.close()}),document.body.appendChild(this.overlay)}createPopup(){this.popup=document.createElement("div"),this.popup.className="pso-popup",this.popup.innerHTML=this.getPopupHTML(),this.overlay.appendChild(this.popup)}getPopupHTML(){const e=this.formatAmount(this.options.amount,this.options.currency);return`\n      <div class="pso-header">\n        <h2>Secure Payment</h2>\n        <button class="pso-close" type="button">&times;</button>\n      </div>\n      <div class="pso-body">\n        <div class="pso-amount">\n          <span class="pso-label">Amount:</span>\n          <span class="pso-value">${e}</span>\n        </div>\n        <form id="pso-payment-form" class="pso-form">\n          <div class="pso-field">\n            <label for="pso-card-number">Card Number</label>\n            <input \n              type="text" \n              id="pso-card-number" \n              name="cardNumber"\n              placeholder="1234 5678 9012 3456"\n              maxlength="23"\n              autocomplete="cc-number"\n              required\n            />\n            <div class="pso-error" id="pso-card-number-error"></div>\n          </div>\n          \n          <div class="pso-row">\n            <div class="pso-field pso-field-half">\n              <label for="pso-expiry">Expiry Date</label>\n              <input \n                type="text" \n                id="pso-expiry" \n                name="expiry"\n                placeholder="MM/YY"\n                maxlength="5"\n                autocomplete="cc-exp"\n                required\n              />\n              <div class="pso-error" id="pso-expiry-error"></div>\n            </div>\n            \n            <div class="pso-field pso-field-half">\n              <label for="pso-cvv">CVV</label>\n              <input \n                type="text" \n                id="pso-cvv" \n                name="cvv"\n                placeholder="123"\n                maxlength="4"\n                autocomplete="cc-csc"\n                required\n              />\n              <div class="pso-error" id="pso-cvv-error"></div>\n            </div>\n          </div>\n          \n          <div class="pso-field">\n            <label for="pso-cardholder">Cardholder Name</label>\n            <input \n              type="text" \n              id="pso-cardholder" \n              name="cardholderName"\n              placeholder="John Doe"\n              autocomplete="cc-name"\n              required\n            />\n            <div class="pso-error" id="pso-cardholder-error"></div>\n          </div>\n          \n          <button type="submit" class="pso-submit-btn" id="pso-submit-btn">\n            Pay ${e}\n          </button>\n        </form>\n        \n        <div class="pso-loading" id="pso-loading" style="display: none;">\n          <div class="pso-spinner"></div>\n          <p>Processing payment...</p>\n        </div>\n        \n        <div class="pso-security-info">\n          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">\n            <path d="M8 0L2 3v4c0 3.5 2.5 6.5 6 7 3.5-.5 6-3.5 6-7V3L8 0z"/>\n          </svg>\n          <span>Secured by PSO Payment Gateway</span>\n        </div>\n      </div>\n    `}attachEventListeners(){this.popup.querySelector(".pso-close").addEventListener("click",()=>this.close()),this.popup.querySelector("#pso-payment-form").addEventListener("submit",e=>this.handleSubmit(e));const e=this.popup.querySelector("#pso-card-number"),n=this.popup.querySelector("#pso-expiry"),t=this.popup.querySelector("#pso-cvv"),o=this.popup.querySelector("#pso-cardholder");e.addEventListener("input",e=>{let n=e.target.value.replace(/\s/g,"");e.target.value=r.formatCardNumber(n),this.validateField("cardNumber",e.target.value)}),n.addEventListener("input",e=>{e.target.value=r.formatExpiry(e.target.value),this.validateField("expiry",e.target.value)}),t.addEventListener("input",e=>{e.target.value=e.target.value.replace(/\D/g,""),this.validateField("cvv",e.target.value)}),o.addEventListener("blur",e=>{this.validateField("cardholderName",e.target.value)})}validateField(e,n){let t,o;switch(e){case"cardNumber":t=r.validateCardNumber(n),o=this.popup.querySelector("#pso-card-number-error");break;case"expiry":t=r.validateExpiry(n),o=this.popup.querySelector("#pso-expiry-error");break;case"cvv":t=r.validateCVV(n),o=this.popup.querySelector("#pso-cvv-error");break;case"cardholderName":t=r.validateCardholderName(n),o=this.popup.querySelector("#pso-cardholder-error")}return o&&(o.textContent=t.message,o.style.display=t.message?"block":"none"),t.valid}async handleSubmit(e){e.preventDefault();const n=new FormData(e.target),t={cardNumber:n.get("cardNumber"),expiry:n.get("expiry"),cvv:n.get("cvv"),cardholderName:n.get("cardholderName"),amount:this.options.amount,currency:this.options.currency};if([this.validateField("cardNumber",t.cardNumber),this.validateField("expiry",t.expiry),this.validateField("cvv",t.cvv),this.validateField("cardholderName",t.cardholderName)].every(e=>e)){this.setLoadingState(!0);try{const e=await this.processPayment(t);this.setLoadingState(!1),e.success?(this.close(),this.options.onSuccess&&this.options.onSuccess(e)):(this.showError(e.message||"Payment failed"),this.options.onError&&this.options.onError(e))}catch(e){this.setLoadingState(!1),this.showError(e.message||"An error occurred"),this.options.onError&&this.options.onError(e)}}}async processPayment(e){const n="production"===this.config.environment?this.config.gatewayUrl||"https://api.pso-gateway.com":this.config.gatewayUrl||"http://localhost:3000",t=await fetch(`${n}/api/payments/process`,{method:"POST",headers:{"Content-Type":"application/json","X-Merchant-ID":this.config.merchantId},body:JSON.stringify({cardNumber:e.cardNumber.replace(/\s/g,""),expiry:e.expiry,cvv:e.cvv,cardholderName:e.cardholderName,amount:e.amount,currency:e.currency})});if(!t.ok)throw new Error("Network error");return await t.json()}setLoadingState(e){const n=this.popup.querySelector("#pso-payment-form"),t=this.popup.querySelector("#pso-loading"),o=this.popup.querySelector("#pso-submit-btn");e?(n.style.display="none",t.style.display="block",o.disabled=!0):(n.style.display="block",t.style.display="none",o.disabled=!1)}showError(e){const n=this.popup.querySelector(".pso-global-error");n&&n.remove();const t=document.createElement("div");t.className="pso-global-error",t.textContent=e;const o=this.popup.querySelector(".pso-body");o.insertBefore(t,o.firstChild),setTimeout(()=>{t.remove()},5e3)}formatAmount(e,n){const t=(e/100).toFixed(2);return`${{USD:"$",EUR:"€",GBP:"£"}[n]||n}${t}`}}var s=t(72),i=t.n(s),p=t(825),c=t.n(p),d=t(659),l=t.n(d),u=t(56),h=t.n(u),m=t(540),f=t.n(m),v=t(113),y=t.n(v),g=t(365),b={};b.styleTagTransform=y(),b.setAttributes=h(),b.insert=l().bind(null,"head"),b.domAPI=c(),b.insertStyleElement=f(),i()(g.A,b),g.A&&g.A.locals&&g.A.locals;class x{constructor(e={}){this.validateConfig(e),this.config={merchantId:e.merchantId,environment:e.environment||"test",gatewayUrl:e.gatewayUrl,theme:e.theme||{},debug:e.debug||!1},this.popup=new a(this.config),this.config.debug&&console.log("[PSO SDK] Initialized with config:",this.config)}validateConfig(e){if(!e.merchantId)throw new Error("PSOPayment: merchantId is required");if(e.environment&&!["test","production"].includes(e.environment))throw new Error('PSOPayment: environment must be "test" or "production"');"production"===e.environment&&"https:"!==window.location.protocol&&console.warn("[PSO SDK] Warning: HTTPS is required for production environment")}showPaymentForm(e={}){this.validatePaymentOptions(e);const n={amount:e.amount,currency:e.currency||"USD",onSuccess:e.onSuccess,onError:e.onError,onCancel:e.onCancel,metadata:e.metadata||{}};this.popup.show(n),this.config.debug&&console.log("[PSO SDK] Showing payment form:",n)}validatePaymentOptions(e){if(!e.amount||"number"!=typeof e.amount||e.amount<=0)throw new Error("PSOPayment: amount must be a positive number (in cents)");if(e.currency&&"string"!=typeof e.currency)throw new Error("PSOPayment: currency must be a string")}closePaymentForm(){this.popup.close()}static get version(){return"1.0.0"}async createPaymentToken(e){const n="production"===this.config.environment?this.config.gatewayUrl||"https://api.pso-gateway.com":this.config.gatewayUrl||"http://localhost:3000";try{const t=await fetch(`${n}/api/tokens/create`,{method:"POST",headers:{"Content-Type":"application/json","X-Merchant-ID":this.config.merchantId},body:JSON.stringify(e)});if(!t.ok)throw new Error("Failed to create payment token");return await t.json()}catch(e){throw this.config.debug&&console.error("[PSO SDK] Token creation failed:",e),e}}async verifyPayment(e){const n="production"===this.config.environment?this.config.gatewayUrl||"https://api.pso-gateway.com":this.config.gatewayUrl||"http://localhost:3000";try{const t=await fetch(`${n}/api/payments/verify/${e}`,{method:"GET",headers:{"X-Merchant-ID":this.config.merchantId}});if(!t.ok)throw new Error("Failed to verify payment");return await t.json()}catch(e){throw this.config.debug&&console.error("[PSO SDK] Payment verification failed:",e),e}}}const w=x;return"undefined"!=typeof window&&(window.PSOPayment=x),o.default})());