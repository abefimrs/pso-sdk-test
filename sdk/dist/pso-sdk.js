!function(n,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.PSOPayment=e():n.PSOPayment=e()}(this,()=>(()=>{"use strict";var n={365(n,e,t){t.d(e,{A:()=>a});var o=t(601),i=t.n(o),r=t(314),s=t.n(r)()(i());s.push([n.id,"/* PSO Payment SDK Styles */\n\n/* Overlay */\n.pso-overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.5);\n  z-index: 999999;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  opacity: 0;\n  transition: opacity 0.3s ease;\n}\n\n.pso-overlay.pso-active {\n  opacity: 1;\n}\n\n/* Popup Container */\n.pso-popup {\n  background: white;\n  border-radius: 12px;\n  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);\n  max-width: 500px;\n  width: 90%;\n  max-height: 90vh;\n  overflow-y: auto;\n  transform: scale(0.9);\n  transition: transform 0.3s ease;\n  display: flex;\n  flex-direction: column;\n}\n\n.pso-popup.pso-popup-iframe {\n  max-width: 800px;\n  height: 80vh;\n  max-height: 700px;\n}\n\n.pso-popup.pso-active {\n  transform: scale(1);\n}\n\n/* Header */\n.pso-header {\n  padding: 20px 24px;\n  border-bottom: 1px solid #e5e7eb;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.pso-header h2 {\n  margin: 0;\n  font-size: 24px;\n  font-weight: 600;\n  color: #111827;\n}\n\n.pso-close {\n  background: none;\n  border: none;\n  font-size: 32px;\n  line-height: 1;\n  color: #6b7280;\n  cursor: pointer;\n  padding: 0;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 4px;\n  transition: background-color 0.2s;\n}\n\n.pso-close:hover {\n  background-color: #f3f4f6;\n}\n\n/* Body */\n.pso-body {\n  padding: 24px;\n}\n\n/* Amount Display */\n.pso-amount {\n  background: #f9fafb;\n  padding: 16px;\n  border-radius: 8px;\n  margin-bottom: 24px;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.pso-amount .pso-label {\n  font-size: 14px;\n  color: #6b7280;\n}\n\n.pso-amount .pso-value {\n  font-size: 24px;\n  font-weight: 700;\n  color: #111827;\n}\n\n/* Form */\n.pso-form {\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n}\n\n.pso-field {\n  display: flex;\n  flex-direction: column;\n}\n\n.pso-field label {\n  font-size: 14px;\n  font-weight: 500;\n  color: #374151;\n  margin-bottom: 6px;\n}\n\n.pso-field input {\n  padding: 12px;\n  border: 1px solid #d1d5db;\n  border-radius: 6px;\n  font-size: 16px;\n  transition: border-color 0.2s, box-shadow 0.2s;\n}\n\n.pso-field input:focus {\n  outline: none;\n  border-color: #3b82f6;\n  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);\n}\n\n.pso-field input::placeholder {\n  color: #9ca3af;\n}\n\n/* Row Layout */\n.pso-row {\n  display: flex;\n  gap: 12px;\n}\n\n.pso-field-half {\n  flex: 1;\n}\n\n/* Error Messages */\n.pso-error {\n  color: #ef4444;\n  font-size: 13px;\n  margin-top: 4px;\n  display: none;\n}\n\n.pso-global-error {\n  background: #fee2e2;\n  color: #991b1b;\n  padding: 12px;\n  border-radius: 6px;\n  margin-bottom: 16px;\n  font-size: 14px;\n}\n\n/* Submit Button */\n.pso-submit-btn {\n  background: #3b82f6;\n  color: white;\n  border: none;\n  padding: 14px 24px;\n  border-radius: 6px;\n  font-size: 16px;\n  font-weight: 600;\n  cursor: pointer;\n  transition: background-color 0.2s;\n  margin-top: 8px;\n}\n\n.pso-submit-btn:hover {\n  background: #2563eb;\n}\n\n.pso-submit-btn:disabled {\n  background: #9ca3af;\n  cursor: not-allowed;\n}\n\n/* Loading State */\n.pso-loading {\n  text-align: center;\n  padding: 40px 20px;\n}\n\n.pso-spinner {\n  width: 48px;\n  height: 48px;\n  border: 4px solid #e5e7eb;\n  border-top-color: #3b82f6;\n  border-radius: 50%;\n  animation: pso-spin 1s linear infinite;\n  margin: 0 auto 16px;\n}\n\n@keyframes pso-spin {\n  to {\n    transform: rotate(360deg);\n  }\n}\n\n.pso-loading p {\n  color: #6b7280;\n  font-size: 14px;\n  margin: 0;\n}\n\n/* Security Info */\n.pso-security-info {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 6px;\n  margin-top: 20px;\n  padding-top: 20px;\n  border-top: 1px solid #e5e7eb;\n  font-size: 12px;\n  color: #6b7280;\n}\n\n.pso-security-info svg {\n  color: #10b981;\n}\n\n/* Responsive Design */\n@media (max-width: 640px) {\n  .pso-popup {\n    width: 95%;\n    max-height: 95vh;\n  }\n\n  .pso-header h2 {\n    font-size: 20px;\n  }\n\n  .pso-amount .pso-value {\n    font-size: 20px;\n  }\n\n  .pso-row {\n    flex-direction: column;\n    gap: 16px;\n  }\n\n  .pso-field-half {\n    width: 100%;\n  }\n  \n  .pso-popup.pso-popup-iframe {\n    max-width: 95%;\n    height: 90vh;\n  }\n}\n\n/* Card Type Icons (Optional Enhancement) */\n.pso-card-icons {\n  display: flex;\n  gap: 8px;\n  margin-top: 8px;\n}\n\n.pso-card-icon {\n  width: 40px;\n  height: 28px;\n  border: 1px solid #e5e7eb;\n  border-radius: 4px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* Iframe Container Styles */\n.pso-iframe-container {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  position: relative;\n  padding: 0;\n  overflow: hidden;\n}\n\n.pso-iframe-container #pso-gateway-iframe {\n  width: 100%;\n  height: 100%;\n  border: none;\n  flex: 1;\n}\n\n.pso-iframe-container #pso-loading {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: white;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  z-index: 10;\n}\n\n/* Footer */\n.pso-footer {\n  padding: 12px 24px;\n  border-top: 1px solid #e5e7eb;\n  background: #f9fafb;\n  border-radius: 0 0 12px 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 10px;\n  color: #6b7280;\n}\n\n",""]);const a=s},314(n){n.exports=function(n){var e=[];return e.toString=function(){return this.map(function(e){var t="",o=void 0!==e[5];return e[4]&&(t+="@supports (".concat(e[4],") {")),e[2]&&(t+="@media ".concat(e[2]," {")),o&&(t+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),t+=n(e),o&&(t+="}"),e[2]&&(t+="}"),e[4]&&(t+="}"),t}).join("")},e.i=function(n,t,o,i,r){"string"==typeof n&&(n=[[null,n,void 0]]);var s={};if(o)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(s[c]=!0)}for(var p=0;p<n.length;p++){var l=[].concat(n[p]);o&&s[l[0]]||(void 0!==r&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=r),t&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=t):l[2]=t),i&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=i):l[4]="".concat(i)),e.push(l))}},e}},601(n){n.exports=function(n){return n[1]}},72(n){var e=[];function t(n){for(var t=-1,o=0;o<e.length;o++)if(e[o].identifier===n){t=o;break}return t}function o(n,o){for(var r={},s=[],a=0;a<n.length;a++){var c=n[a],p=o.base?c[0]+o.base:c[0],l=r[p]||0,d="".concat(p," ").concat(l);r[p]=l+1;var u=t(d),h={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==u)e[u].references++,e[u].updater(h);else{var f=i(h,o);o.byIndex=a,e.splice(a,0,{identifier:d,updater:f,references:1})}s.push(d)}return s}function i(n,e){var t=e.domAPI(e);return t.update(n),function(e){if(e){if(e.css===n.css&&e.media===n.media&&e.sourceMap===n.sourceMap&&e.supports===n.supports&&e.layer===n.layer)return;t.update(n=e)}else t.remove()}}n.exports=function(n,i){var r=o(n=n||[],i=i||{});return function(n){n=n||[];for(var s=0;s<r.length;s++){var a=t(r[s]);e[a].references--}for(var c=o(n,i),p=0;p<r.length;p++){var l=t(r[p]);0===e[l].references&&(e[l].updater(),e.splice(l,1))}r=c}}},659(n){var e={};n.exports=function(n,t){var o=function(n){if(void 0===e[n]){var t=document.querySelector(n);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(n){t=null}e[n]=t}return e[n]}(n);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}},540(n){n.exports=function(n){var e=document.createElement("style");return n.setAttributes(e,n.attributes),n.insert(e,n.options),e}},56(n,e,t){n.exports=function(n){var e=t.nc;e&&n.setAttribute("nonce",e)}},825(n){n.exports=function(n){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=n.insertStyleElement(n);return{update:function(t){!function(n,e,t){var o="";t.supports&&(o+="@supports (".concat(t.supports,") {")),t.media&&(o+="@media ".concat(t.media," {"));var i=void 0!==t.layer;i&&(o+="@layer".concat(t.layer.length>0?" ".concat(t.layer):""," {")),o+=t.css,i&&(o+="}"),t.media&&(o+="}"),t.supports&&(o+="}");var r=t.sourceMap;r&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleTagTransform(o,n,e.options)}(e,n,t)},remove:function(){!function(n){if(null===n.parentNode)return!1;n.parentNode.removeChild(n)}(e)}}}},113(n){n.exports=function(n,e){if(e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}}},e={};function t(o){var i=e[o];if(void 0!==i)return i.exports;var r=e[o]={id:o,exports:{}};return n[o](r,r.exports,t),r.exports}t.n=n=>{var e=n&&n.__esModule?()=>n.default:()=>n;return t.d(e,{a:e}),e},t.d=(n,e)=>{for(var o in e)t.o(e,o)&&!t.o(n,o)&&Object.defineProperty(n,o,{enumerable:!0,get:e[o]})},t.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),t.nc=void 0;var o={};t.d(o,{default:()=>b});class i{constructor(n){this.config=n,this.overlay=null,this.popup=null,this.iframe=null,this.popupWindow=null,this.isOpen=!1,this.messageListener=null,this.intervalCheck=null}show(n){if(this.isOpen)return;this.options=n;const e=this.config.usePopupWindow||!1;e?this.openPopupWindow():(this.createOverlay(),this.createIframePopup(),this.attachEventListeners()),this.isOpen=!0,this.setupMessageListener(),e||(document.body.style.overflow="hidden",setTimeout(()=>{this.overlay.classList.add("pso-active"),this.popup.classList.add("pso-active")},10))}close(){this.isOpen&&(this.messageListener&&(window.removeEventListener("message",this.messageListener),this.messageListener=null),this.intervalCheck&&(clearInterval(this.intervalCheck),this.intervalCheck=null),this.popupWindow&&!this.popupWindow.closed&&(this.popupWindow.close(),this.popupWindow=null),this.overlay?(this.overlay.classList.remove("pso-active"),this.popup&&this.popup.classList.remove("pso-active"),setTimeout(()=>{this.overlay&&this.overlay.parentNode&&this.overlay.parentNode.removeChild(this.overlay),this.overlay=null,this.popup=null,this.iframe=null,this.isOpen=!1,document.body.style.overflow=""},300)):this.isOpen=!1)}openPopupWindow(){const n=`width=600,height=700,left=${(window.screen.width-600)/2},top=${(window.screen.height-700)/2},toolbar=no,menubar=no,scrollbars=yes,resizable=yes`;if(this.popupWindow=window.open(this.options.gatewayUrl,"PSOPaymentGateway",n),!this.popupWindow)return console.warn("[PSO SDK] Popup blocked, falling back to iframe"),this.createOverlay(),this.createIframePopup(),this.attachEventListeners(),document.body.style.overflow="hidden",void setTimeout(()=>{this.overlay.classList.add("pso-active"),this.popup.classList.add("pso-active")},10);this.intervalCheck=setInterval(()=>{this.popupWindow&&this.popupWindow.closed&&(clearInterval(this.intervalCheck),this.intervalCheck=null,this.handleCancel())},500),this.popupWindow.focus&&this.popupWindow.focus()}createOverlay(){this.overlay=document.createElement("div"),this.overlay.className="pso-overlay",document.body.appendChild(this.overlay)}createIframePopup(){this.popup=document.createElement("div"),this.popup.className="pso-popup pso-popup-iframe",this.popup.innerHTML=this.getIframePopupHTML(),this.overlay.appendChild(this.popup),this.iframe=this.popup.querySelector("#pso-gateway-iframe")}getIframePopupHTML(){return`\n      <div class="pso-header">\n        <h2>Secure Payment</h2>\n        <button class="pso-close" type="button">&times;</button>\n      </div>\n      <div class="pso-body pso-iframe-container">\n        <div class="pso-loading" id="pso-loading">\n          <div class="pso-spinner"></div>\n          <p>Loading payment gateway...</p>\n        </div>\n        <iframe \n          id="pso-gateway-iframe" \n          src="${this.options.gatewayUrl}" \n          frameborder="0"\n          allow="payment"\n          sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-top-navigation"\n        ></iframe>\n      </div>\n      <div class="pso-footer">\n        <div class="pso-security-info">\n          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">\n            <path d="M8 0L2 3v4c0 3.5 2.5 6.5 6 7 3.5-.5 6-3.5 6-7V3L8 0z"/>\n          </svg>\n          <span>Secured by PSO Payment Gateway</span>\n        </div>\n      </div>\n    `}attachEventListeners(){this.popup.querySelector(".pso-close").addEventListener("click",()=>{this.handleCancel()}),this.iframe&&this.iframe.addEventListener("load",()=>{const n=this.popup.querySelector("#pso-loading");n&&(n.style.display="none")})}setupMessageListener(){this.messageListener=n=>{const e=n.data;this.config.debug&&console.log("[PSO SDK] Received message:",e),e&&"object"==typeof e&&("PAYMENT_SUCCESS"===e.type||"SUCCESS"===e.status||!0===e.success?this.handleSuccess(e):"PAYMENT_FAILURE"===e.type||"FAILED"===e.status||!1===e.success?this.handleError(e):"PAYMENT_CANCEL"!==e.type&&"CANCELLED"!==e.status||this.handleCancel()),"string"==typeof e&&(e.includes("success")||e.includes("payment-success")?this.handleSuccess({redirectUrl:e}):e.includes("cancel")||e.includes("payment-cancel")?this.handleCancel():(e.includes("failure")||e.includes("payment-failure"))&&this.handleError({redirectUrl:e}))},window.addEventListener("message",this.messageListener),!this.config.usePopupWindow&&this.iframe&&this.monitorIframeRedirects()}monitorIframeRedirects(){try{let n=this.options.gatewayUrl;const e=setInterval(()=>{if(this.iframe&&this.isOpen)try{const t=this.iframe.contentWindow.location.href;t!==n&&(n=t,this.options.successUrl&&t.includes(this.options.successUrl)?(clearInterval(e),this.handleSuccess({redirectUrl:t})):this.options.failureUrl&&t.includes(this.options.failureUrl)?(clearInterval(e),this.handleError({redirectUrl:t})):this.options.cancelUrl&&t.includes(this.options.cancelUrl)&&(clearInterval(e),this.handleCancel()))}catch(n){}else clearInterval(e)},500)}catch(n){}}handleSuccess(n){this.config.debug&&console.log("[PSO SDK] Payment successful:",n),this.close(),this.options.onSuccess&&this.options.onSuccess({success:!0,transactionId:this.options.transactionId,sessionId:this.options.sessionId,...n})}handleError(n){this.config.debug&&console.error("[PSO SDK] Payment failed:",n),this.close(),this.options.onError&&this.options.onError({success:!1,message:n.message||"Payment failed",transactionId:this.options.transactionId,...n})}handleCancel(){this.config.debug&&console.log("[PSO SDK] Payment cancelled"),this.close(),this.options.onCancel&&this.options.onCancel({success:!1,message:"Payment cancelled by user",transactionId:this.options.transactionId})}}var r=t(72),s=t.n(r),a=t(825),c=t.n(a),p=t(659),l=t.n(p),d=t(56),u=t.n(d),h=t(540),f=t.n(h),m=t(113),y=t.n(m),g=t(365),v={};v.styleTagTransform=y(),v.setAttributes=u(),v.insert=l().bind(null,"head"),v.domAPI=c(),v.insertStyleElement=f(),s()(g.A,v),g.A&&g.A.locals&&g.A.locals;class w{constructor(n={}){this.validateConfig(n),this.config={merchantId:n.merchantId,environment:n.environment||"test",gatewayUrl:n.gatewayUrl,theme:n.theme||{},debug:n.debug||!1},this.popup=new i(this.config),this.config.debug&&console.log("[PSO SDK] Initialized with config:",this.config)}validateConfig(n){if(!n.merchantId)throw new Error("PSOPayment: merchantId is required");if(n.environment&&!["test","production"].includes(n.environment))throw new Error('PSOPayment: environment must be "test" or "production"');"production"===n.environment&&"https:"!==window.location.protocol&&console.warn("[PSO SDK] Warning: HTTPS is required for production environment")}async showPaymentForm(n={}){this.validatePaymentOptions(n);const e={orderId:n.orderId||this.generateOrderId(),amount:n.amount,currency:n.currency||"BDT",customerInfo:n.customerInfo||{},productInfo:n.productInfo||{},promotionInfo:n.promotionInfo,discountDetail:n.discountDetail,ipnUrl:n.ipnUrl,successUrl:n.successUrl,cancelUrl:n.cancelUrl,failureUrl:n.failureUrl,customFields:n.customFields||{},onSuccess:n.onSuccess,onError:n.onError,onCancel:n.onCancel,metadata:n.metadata||{}};this.config.debug&&console.log("[PSO SDK] Creating payment order:",e);try{const n=await this.createPaymentOrder(e);if(!n.success||!n.gatewayPageUrl)throw new Error(n.message||"Failed to create payment order");this.popup.show({gatewayUrl:n.gatewayPageUrl,transactionId:n.transactionId,sessionId:n.sessionId,onSuccess:e.onSuccess,onError:e.onError,onCancel:e.onCancel})}catch(n){throw this.config.debug&&console.error("[PSO SDK] Payment initialization failed:",n),e.onError&&e.onError(n),n}}async createPaymentOrder(n){const e="production"===this.config.environment?this.config.gatewayUrl||"https://api.pso-gateway.com":this.config.gatewayUrl||"http://localhost:3000";try{const t={order_id:n.orderId,order_information:{payable_amount:parseFloat(n.amount),currency_code:n.currency},customer_information:n.customerInfo,product_information:n.productInfo,ipn_url:n.ipnUrl,success_url:n.successUrl,cancel_url:n.cancelUrl,failure_url:n.failureUrl};n.promotionInfo&&(t.promotion_information=n.promotionInfo),n.discountDetail&&(t.discount_detail=n.discountDetail),n.customFields&&Object.assign(t,n.customFields);const o=await fetch(`${e}/payment/api/v1/p/service/api/payment/processing/payment-order`,{method:"POST",headers:{"Content-Type":"application/json","X-Merchant-Id":this.config.merchantId},body:JSON.stringify(t)});if(!o.ok){const n=await o.json().catch(()=>({}));throw new Error(n.message||"Failed to create payment order")}const i=await o.json();return this.config.debug&&console.log("[PSO SDK] Payment order created:",i),i}catch(n){throw this.config.debug&&console.error("[PSO SDK] Payment order creation failed:",n),n}}generateOrderId(){return"ORD-"+Date.now()+"-"+Math.random().toString(36).substr(2,9).toUpperCase()}validatePaymentOptions(n){if(!n.amount||"number"!=typeof n.amount||n.amount<=0)throw new Error("PSOPayment: amount must be a positive number");if(n.currency&&"string"!=typeof n.currency)throw new Error("PSOPayment: currency must be a string")}async verifyPaymentStatus(n){const e="production"===this.config.environment?this.config.gatewayUrl||"https://api.pso-gateway.com":this.config.gatewayUrl||"http://localhost:3000";try{const t=await fetch(`${e}/payment/api/v1/p/service/api/payment/processing/verify`,{method:"POST",headers:{"Content-Type":"application/json","X-Merchant-Id":this.config.merchantId},body:JSON.stringify({paymentOrderId:n})});if(!t.ok)throw new Error("Failed to verify payment");return await t.json()}catch(n){throw this.config.debug&&console.error("[PSO SDK] Payment verification failed:",n),n}}closePaymentForm(){this.popup.close()}static get version(){return"1.0.0"}async createPaymentToken(n){const e="production"===this.config.environment?this.config.gatewayUrl||"https://api.pso-gateway.com":this.config.gatewayUrl||"http://localhost:3000";try{const t=await fetch(`${e}/api/tokens/create`,{method:"POST",headers:{"Content-Type":"application/json","X-Merchant-ID":this.config.merchantId},body:JSON.stringify(n)});if(!t.ok)throw new Error("Failed to create payment token");return await t.json()}catch(n){throw this.config.debug&&console.error("[PSO SDK] Token creation failed:",n),n}}async verifyPayment(n){const e="production"===this.config.environment?this.config.gatewayUrl||"https://api.pso-gateway.com":this.config.gatewayUrl||"http://localhost:3000";try{const t=await fetch(`${e}/api/payments/verify/${n}`,{method:"GET",headers:{"X-Merchant-ID":this.config.merchantId}});if(!t.ok)throw new Error("Failed to verify payment");return await t.json()}catch(n){throw this.config.debug&&console.error("[PSO SDK] Payment verification failed:",n),n}}}const b=w;return"undefined"!=typeof window&&(window.PSOPayment=w),o.default})());