{"version":3,"file":"pso-sdk.min.js","mappings":"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","sources":["webpack://PSOPayment/webpack/universalModuleDefinition","webpack://PSOPayment/webpack/bootstrap","webpack://PSOPayment/webpack/runtime/define property getters","webpack://PSOPayment/webpack/runtime/hasOwnProperty shorthand","webpack://PSOPayment/./src/popup.js","webpack://PSOPayment/./src/payment-sdk.js","webpack://PSOPayment/./src/index.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"PSOPayment\"] = factory();\n\telse\n\t\troot[\"PSOPayment\"] = factory();\n})(this, function() {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","/**\n * Payment Pop-up Manager\n * Handles opening gateway URL in popup/iframe and monitoring payment completion\n */\n\nexport class PaymentPopup {\n  constructor(config) {\n    this.config = config;\n    this.overlay = null;\n    this.popup = null;\n    this.iframe = null;\n    this.popupWindow = null;\n    this.isOpen = false;\n    this.messageListener = null;\n    this.intervalCheck = null;\n  }\n\n  /**\n   * Show the payment pop-up with gateway URL\n   */\n  show(options) {\n    if (this.isOpen) {\n      return;\n    }\n\n    this.options = options;\n    \n    // Decide between iframe (default) or popup window\n    const usePopupWindow = this.config.usePopupWindow || false;\n    \n    if (usePopupWindow) {\n      this.openPopupWindow();\n    } else {\n      this.createOverlay();\n      this.createIframePopup();\n      this.attachEventListeners();\n    }\n    \n    this.isOpen = true;\n    \n    // Listen for payment completion messages\n    this.setupMessageListener();\n\n    // Prevent body scrolling when using overlay\n    if (!usePopupWindow) {\n      document.body.style.overflow = 'hidden';\n\n      // Trigger animation\n      setTimeout(() => {\n        this.overlay.classList.add('pso-active');\n        this.popup.classList.add('pso-active');\n      }, 10);\n    }\n  }\n\n  /**\n   * Close the payment pop-up\n   */\n  close() {\n    if (!this.isOpen) {\n      return;\n    }\n\n    // Clean up message listener\n    if (this.messageListener) {\n      window.removeEventListener('message', this.messageListener);\n      this.messageListener = null;\n    }\n\n    // Clean up popup window check interval\n    if (this.intervalCheck) {\n      clearInterval(this.intervalCheck);\n      this.intervalCheck = null;\n    }\n\n    // Close popup window if open\n    if (this.popupWindow && !this.popupWindow.closed) {\n      this.popupWindow.close();\n      this.popupWindow = null;\n    }\n\n    // Close iframe overlay\n    if (this.overlay) {\n      this.overlay.classList.remove('pso-active');\n      if (this.popup) {\n        this.popup.classList.remove('pso-active');\n      }\n\n      setTimeout(() => {\n        if (this.overlay && this.overlay.parentNode) {\n          this.overlay.parentNode.removeChild(this.overlay);\n        }\n        this.overlay = null;\n        this.popup = null;\n        this.iframe = null;\n        this.isOpen = false;\n        document.body.style.overflow = '';\n      }, 300);\n    } else {\n      this.isOpen = false;\n    }\n  }\n\n  /**\n   * Open gateway URL in popup window\n   */\n  openPopupWindow() {\n    const width = 600;\n    const height = 700;\n    const left = (window.screen.width - width) / 2;\n    const top = (window.screen.height - height) / 2;\n\n    const features = `width=${width},height=${height},left=${left},top=${top},toolbar=no,menubar=no,scrollbars=yes,resizable=yes`;\n\n    this.popupWindow = window.open(\n      this.options.gatewayUrl,\n      'PSOPaymentGateway',\n      features\n    );\n\n    if (!this.popupWindow) {\n      // Popup blocked - fallback to iframe\n      console.warn('[PSO SDK] Popup blocked, falling back to iframe');\n      this.createOverlay();\n      this.createIframePopup();\n      this.attachEventListeners();\n      document.body.style.overflow = 'hidden';\n      setTimeout(() => {\n        this.overlay.classList.add('pso-active');\n        this.popup.classList.add('pso-active');\n      }, 10);\n      return;\n    }\n\n    // Check if popup is closed\n    this.intervalCheck = setInterval(() => {\n      if (this.popupWindow && this.popupWindow.closed) {\n        clearInterval(this.intervalCheck);\n        this.intervalCheck = null;\n        this.handleCancel();\n      }\n    }, 500);\n\n    // Focus on popup\n    if (this.popupWindow.focus) {\n      this.popupWindow.focus();\n    }\n  }\n\n  /**\n   * Create overlay element\n   */\n  createOverlay() {\n    this.overlay = document.createElement('div');\n    this.overlay.className = 'pso-overlay';\n    document.body.appendChild(this.overlay);\n  }\n\n  /**\n   * Create popup with iframe showing gateway page\n   */\n  createIframePopup() {\n    this.popup = document.createElement('div');\n    this.popup.className = 'pso-popup pso-popup-iframe';\n    this.popup.innerHTML = this.getIframePopupHTML();\n    this.overlay.appendChild(this.popup);\n\n    // Get iframe element\n    this.iframe = this.popup.querySelector('#pso-gateway-iframe');\n  }\n\n  /**\n   * Get HTML content for iframe popup\n   */\n  getIframePopupHTML() {\n    return `\n      <div class=\"pso-header\">\n        <h2>Secure Payment</h2>\n        <button class=\"pso-close\" type=\"button\">&times;</button>\n      </div>\n      <div class=\"pso-body pso-iframe-container\">\n        <div class=\"pso-loading\" id=\"pso-loading\">\n          <div class=\"pso-spinner\"></div>\n          <p>Loading payment gateway...</p>\n        </div>\n        <iframe \n          id=\"pso-gateway-iframe\" \n          src=\"${this.options.gatewayUrl}\" \n          frameborder=\"0\"\n          allow=\"payment\"\n          sandbox=\"allow-same-origin allow-scripts allow-forms allow-popups allow-top-navigation\"\n        ></iframe>\n      </div>\n      <div class=\"pso-footer\">\n        <div class=\"pso-security-info\">\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n            <path d=\"M8 0L2 3v4c0 3.5 2.5 6.5 6 7 3.5-.5 6-3.5 6-7V3L8 0z\"/>\n          </svg>\n          <span>Secured by PSO Payment Gateway</span>\n        </div>\n      </div>\n    `;\n  }\n\n  /**\n   * Attach event listeners\n   */\n  attachEventListeners() {\n    // Close button\n    const closeBtn = this.popup.querySelector('.pso-close');\n    closeBtn.addEventListener('click', () => {\n      this.handleCancel();\n    });\n\n    // Iframe load event\n    if (this.iframe) {\n      this.iframe.addEventListener('load', () => {\n        const loading = this.popup.querySelector('#pso-loading');\n        if (loading) {\n          loading.style.display = 'none';\n        }\n      });\n    }\n  }\n\n  /**\n   * Setup message listener for payment completion\n   */\n  setupMessageListener() {\n    this.messageListener = (event) => {\n      // Verify origin if needed\n      // if (event.origin !== this.expectedOrigin) return;\n\n      const data = event.data;\n\n      if (this.config.debug) {\n        console.log('[PSO SDK] Received message:', data);\n      }\n\n      // Handle payment completion messages\n      if (data && typeof data === 'object') {\n        if (data.type === 'PAYMENT_SUCCESS' || data.status === 'SUCCESS' || data.success === true) {\n          this.handleSuccess(data);\n        } else if (data.type === 'PAYMENT_FAILURE' || data.status === 'FAILED' || data.success === false) {\n          this.handleError(data);\n        } else if (data.type === 'PAYMENT_CANCEL' || data.status === 'CANCELLED') {\n          this.handleCancel();\n        }\n      }\n\n      // Also listen for redirect URLs\n      if (typeof data === 'string') {\n        if (data.includes('success') || data.includes('payment-success')) {\n          this.handleSuccess({ redirectUrl: data });\n        } else if (data.includes('cancel') || data.includes('payment-cancel')) {\n          this.handleCancel();\n        } else if (data.includes('failure') || data.includes('payment-failure')) {\n          this.handleError({ redirectUrl: data });\n        }\n      }\n    };\n\n    window.addEventListener('message', this.messageListener);\n\n    // Also monitor URL changes for redirect detection\n    if (!this.config.usePopupWindow && this.iframe) {\n      this.monitorIframeRedirects();\n    }\n  }\n\n  /**\n   * Monitor iframe URL changes for payment completion\n   */\n  monitorIframeRedirects() {\n    // This is limited due to same-origin policy\n    // The gateway should send postMessage for best results\n    try {\n      let lastUrl = this.options.gatewayUrl;\n      \n      const checkUrl = setInterval(() => {\n        if (!this.iframe || !this.isOpen) {\n          clearInterval(checkUrl);\n          return;\n        }\n\n        try {\n          const currentUrl = this.iframe.contentWindow.location.href;\n          if (currentUrl !== lastUrl) {\n            lastUrl = currentUrl;\n            \n            // Check if redirected to success/failure/cancel URL\n            if (this.options.successUrl && currentUrl.includes(this.options.successUrl)) {\n              clearInterval(checkUrl);\n              this.handleSuccess({ redirectUrl: currentUrl });\n            } else if (this.options.failureUrl && currentUrl.includes(this.options.failureUrl)) {\n              clearInterval(checkUrl);\n              this.handleError({ redirectUrl: currentUrl });\n            } else if (this.options.cancelUrl && currentUrl.includes(this.options.cancelUrl)) {\n              clearInterval(checkUrl);\n              this.handleCancel();\n            }\n          }\n        } catch (e) {\n          // Cross-origin access blocked - expected\n        }\n      }, 500);\n    } catch (e) {\n      // Silently fail - cross-origin restrictions\n    }\n  }\n\n  /**\n   * Handle successful payment\n   */\n  handleSuccess(data) {\n    if (this.config.debug) {\n      console.log('[PSO SDK] Payment successful:', data);\n    }\n\n    this.close();\n\n    if (this.options.onSuccess) {\n      this.options.onSuccess({\n        success: true,\n        transactionId: this.options.transactionId,\n        sessionId: this.options.sessionId,\n        ...data\n      });\n    }\n  }\n\n  /**\n   * Handle payment error\n   */\n  handleError(data) {\n    if (this.config.debug) {\n      console.error('[PSO SDK] Payment failed:', data);\n    }\n\n    this.close();\n\n    if (this.options.onError) {\n      this.options.onError({\n        success: false,\n        message: data.message || 'Payment failed',\n        transactionId: this.options.transactionId,\n        ...data\n      });\n    }\n  }\n\n  /**\n   * Handle payment cancellation\n   */\n  handleCancel() {\n    if (this.config.debug) {\n      console.log('[PSO SDK] Payment cancelled');\n    }\n\n    this.close();\n\n    if (this.options.onCancel) {\n      this.options.onCancel({\n        success: false,\n        message: 'Payment cancelled by user',\n        transactionId: this.options.transactionId\n      });\n    }\n  }\n}\n","/**\n * PSO Payment SDK\n * Main SDK class for payment gateway integration\n */\n\nimport { PaymentPopup } from './popup.js';\nimport './styles.css';\n\nclass PSOPayment {\n  constructor(config = {}) {\n    this.validateConfig(config);\n    \n    this.config = {\n      merchantId: config.merchantId,\n      environment: config.environment || 'test',\n      gatewayUrl: config.gatewayUrl,\n      theme: config.theme || {},\n      debug: config.debug || false\n    };\n\n    this.popup = new PaymentPopup(this.config);\n    \n    if (this.config.debug) {\n      console.log('[PSO SDK] Initialized with config:', this.config);\n    }\n  }\n\n  /**\n   * Validate configuration\n   */\n  validateConfig(config) {\n    if (!config.merchantId) {\n      throw new Error('PSOPayment: merchantId is required');\n    }\n\n    if (config.environment && !['test', 'production'].includes(config.environment)) {\n      throw new Error('PSOPayment: environment must be \"test\" or \"production\"');\n    }\n\n    // Enforce HTTPS in production\n    if (config.environment === 'production' && window.location.protocol !== 'https:') {\n      console.warn('[PSO SDK] Warning: HTTPS is required for production environment');\n    }\n  }\n\n  /**\n   * Show payment form (opens gateway in popup)\n   */\n  async showPaymentForm(options = {}) {\n    this.validatePaymentOptions(options);\n\n    const paymentOptions = {\n      orderId: options.orderId || this.generateOrderId(),\n      amount: options.amount,\n      currency: options.currency || 'BDT',\n      customerInfo: options.customerInfo || {},\n      productInfo: options.productInfo || {},\n      promotionInfo: options.promotionInfo,\n      discountDetail: options.discountDetail,\n      ipnUrl: options.ipnUrl,\n      successUrl: options.successUrl,\n      cancelUrl: options.cancelUrl,\n      failureUrl: options.failureUrl,\n      customFields: options.customFields || {},\n      onSuccess: options.onSuccess,\n      onError: options.onError,\n      onCancel: options.onCancel,\n      metadata: options.metadata || {}\n    };\n\n    if (this.config.debug) {\n      console.log('[PSO SDK] Creating payment order:', paymentOptions);\n    }\n\n    try {\n      // Create payment order and get gateway URL\n      const orderResult = await this.createPaymentOrder(paymentOptions);\n      \n      if (orderResult.success && orderResult.gatewayPageUrl) {\n        // Open gateway URL in popup\n        this.popup.show({\n          gatewayUrl: orderResult.gatewayPageUrl,\n          transactionId: orderResult.transactionId,\n          sessionId: orderResult.sessionId,\n          onSuccess: paymentOptions.onSuccess,\n          onError: paymentOptions.onError,\n          onCancel: paymentOptions.onCancel\n        });\n      } else {\n        throw new Error(orderResult.message || 'Failed to create payment order');\n      }\n    } catch (error) {\n      if (this.config.debug) {\n        console.error('[PSO SDK] Payment initialization failed:', error);\n      }\n      if (paymentOptions.onError) {\n        paymentOptions.onError(error);\n      }\n      throw error;\n    }\n  }\n\n  /**\n   * Create payment order with gateway\n   */\n  async createPaymentOrder(options) {\n    const gatewayUrl = this.config.environment === 'production'\n      ? this.config.gatewayUrl || 'https://api.pso-gateway.com'\n      : this.config.gatewayUrl || 'http://localhost:3000';\n\n    try {\n      // Build request body matching exact API specification\n      const requestBody = {\n        order_id: options.orderId,\n        order_information: {\n          payable_amount: parseFloat(options.amount),\n          currency_code: options.currency\n        },\n        customer_information: options.customerInfo,\n        product_information: options.productInfo,\n        ipn_url: options.ipnUrl,\n        success_url: options.successUrl,\n        cancel_url: options.cancelUrl,\n        failure_url: options.failureUrl\n      };\n\n      // Add optional fields if provided\n      if (options.promotionInfo) {\n        requestBody.promotion_information = options.promotionInfo;\n      }\n      if (options.discountDetail) {\n        requestBody.discount_detail = options.discountDetail;\n      }\n      if (options.customFields) {\n        Object.assign(requestBody, options.customFields);\n      }\n\n      // Gateway proxy will add TNPG authentication headers:\n      // X-TNPG-TIMESTAMP, X-TNPG-HOST, X-TNPG-TARGET-API,\n      // X-TNPG-MERCHANT-ID, X-TNPG-API-KEY, X-TNPG-SIGNATURE, X-TNPG-DIGEST\n      const response = await fetch(`${gatewayUrl}/payment/api/v1/p/service/api/payment/processing/payment-order`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-Merchant-Id': this.config.merchantId\n        },\n        body: JSON.stringify(requestBody)\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(errorData.message || 'Failed to create payment order');\n      }\n\n      const result = await response.json();\n      \n      // Parse response according to API specification\n      // Response contains: order_detail, gateway_page_url, token_response\n      if (this.config.debug) {\n        console.log('[PSO SDK] Payment order created:', result);\n      }\n      \n      return result;\n    } catch (error) {\n      if (this.config.debug) {\n        console.error('[PSO SDK] Payment order creation failed:', error);\n      }\n      throw error;\n    }\n  }\n\n  /**\n   * Generate unique order ID\n   */\n  generateOrderId() {\n    return 'ORD-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9).toUpperCase();\n  }\n\n  /**\n   * Validate payment options\n   */\n  validatePaymentOptions(options) {\n    if (!options.amount || typeof options.amount !== 'number' || options.amount <= 0) {\n      throw new Error('PSOPayment: amount must be a positive number');\n    }\n\n    if (options.currency && typeof options.currency !== 'string') {\n      throw new Error('PSOPayment: currency must be a string');\n    }\n  }\n\n  /**\n   * Verify payment status\n   */\n  async verifyPaymentStatus(paymentOrderId) {\n    const gatewayUrl = this.config.environment === 'production'\n      ? this.config.gatewayUrl || 'https://api.pso-gateway.com'\n      : this.config.gatewayUrl || 'http://localhost:3000';\n\n    try {\n      // Gateway proxy will add TNPG authentication headers\n      const response = await fetch(`${gatewayUrl}/payment/api/v1/p/service/api/payment/processing/verify`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-Merchant-Id': this.config.merchantId\n        },\n        body: JSON.stringify({\n          paymentOrderId: paymentOrderId\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to verify payment');\n      }\n\n      return await response.json();\n    } catch (error) {\n      if (this.config.debug) {\n        console.error('[PSO SDK] Payment verification failed:', error);\n      }\n      throw error;\n    }\n  }\n\n  /**\n   * Close payment form\n   */\n  closePaymentForm() {\n    this.popup.close();\n  }\n\n  /**\n   * Get SDK version\n   */\n  static get version() {\n    return '1.0.0';\n  }\n\n  /**\n   * Create a payment token (for advanced integrations)\n   */\n  async createPaymentToken(cardData) {\n    const gatewayUrl = this.config.environment === 'production'\n      ? this.config.gatewayUrl || 'https://api.pso-gateway.com'\n      : this.config.gatewayUrl || 'http://localhost:3000';\n\n    try {\n      const response = await fetch(`${gatewayUrl}/api/tokens/create`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-Merchant-ID': this.config.merchantId\n        },\n        body: JSON.stringify(cardData)\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to create payment token');\n      }\n\n      return await response.json();\n    } catch (error) {\n      if (this.config.debug) {\n        console.error('[PSO SDK] Token creation failed:', error);\n      }\n      throw error;\n    }\n  }\n\n  /**\n   * Verify a payment\n   */\n  async verifyPayment(transactionId) {\n    const gatewayUrl = this.config.environment === 'production'\n      ? this.config.gatewayUrl || 'https://api.pso-gateway.com'\n      : this.config.gatewayUrl || 'http://localhost:3000';\n\n    try {\n      const response = await fetch(`${gatewayUrl}/api/payments/verify/${transactionId}`, {\n        method: 'GET',\n        headers: {\n          'X-Merchant-ID': this.config.merchantId\n        }\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to verify payment');\n      }\n\n      return await response.json();\n    } catch (error) {\n      if (this.config.debug) {\n        console.error('[PSO SDK] Payment verification failed:', error);\n      }\n      throw error;\n    }\n  }\n}\n\n// Export for different module systems\nexport default PSOPayment;\n\n// Also attach to window for script tag usage\nif (typeof window !== 'undefined') {\n  window.PSOPayment = PSOPayment;\n}\n","/**\n * PSO Payment SDK - Main Entry Point\n * \n * @module @pso/payment-sdk\n */\n\nimport PSOPayment from './payment-sdk.js';\nimport './styles.css';\n\nexport default PSOPayment;\nexport { PSOPayment };\n\n// Make available globally in browser environments\nif (typeof window !== 'undefined') {\n  window.PSOPayment = PSOPayment;\n}\n"],"names":["root","factory","exports","module","define","amd","this","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","PaymentPopup","constructor","config","overlay","popup","iframe","popupWindow","isOpen","messageListener","intervalCheck","show","options","usePopupWindow","openPopupWindow","createOverlay","createIframePopup","attachEventListeners","setupMessageListener","document","body","style","overflow","setTimeout","classList","add","close","window","removeEventListener","clearInterval","closed","remove","parentNode","removeChild","features","screen","width","height","open","gatewayUrl","setInterval","handleCancel","focus","createElement","className","appendChild","innerHTML","getIframePopupHTML","querySelector","addEventListener","loading","display","event","data","debug","type","status","success","handleSuccess","handleError","includes","redirectUrl","monitorIframeRedirects","lastUrl","checkUrl","currentUrl","contentWindow","location","href","successUrl","failureUrl","cancelUrl","e","onSuccess","transactionId","sessionId","onError","message","onCancel","PSOPayment","validateConfig","merchantId","environment","theme","Error","protocol","showPaymentForm","validatePaymentOptions","paymentOptions","orderId","generateOrderId","amount","currency","customerInfo","productInfo","promotionInfo","discountDetail","ipnUrl","customFields","metadata","orderResult","createPaymentOrder","gatewayPageUrl","error","requestBody","order_id","order_information","payable_amount","parseFloat","currency_code","customer_information","product_information","ipn_url","success_url","cancel_url","failure_url","promotion_information","discount_detail","assign","response","fetch","method","headers","JSON","stringify","ok","errorData","json","catch","result","Date","now","Math","random","toString","substr","toUpperCase","verifyPaymentStatus","paymentOrderId","closePaymentForm","version","createPaymentToken","cardData","verifyPayment"],"sourceRoot":""}